# 5. Layouts and Pages

## Understanding Layouts

A **layout** is like a template wrapper - it defines the common structure that wraps your page content.

**Python analogy (Jinja2/Django):**

```python
# base.html (layout)
<html>
  <head><title>{{ title }}</title></head>
  <body>
    <nav>Navigation here</nav>
    {% block content %}{% endblock %}  â† Page content goes here
    <footer>Footer here</footer>
  </body>
</html>

# page.html (uses base)
{% extends "base.html" %}
{% block content %}
  <h1>My Page</h1>
{% endblock %}
```

## Your Layout.astro

Let's analyze `src/layouts/Layout.astro`:

```astro
---
// Import global styles
import '../styles/global.css';

// Define props (what data does the layout need?)
interface Props {
  title: string;
  description?: string;  // Optional, has default
}

const { title, description = 'AI-curated content digests' } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- NAVIGATION BAR -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
      <div class="max-w-4xl mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <!-- Logo/Home link -->
          <a href="/" class="flex items-center gap-2 text-xl font-bold">
            <span>ğŸ“°</span>
            <span>Digest Viewer</span>
          </a>

          <!-- Nav links -->
          <nav class="flex items-center gap-4">
            <a href="/bookmarks" class="text-sm">
              <span>ğŸ”–</span>
              <span>Bookmarks</span>
            </a>
          </nav>
        </div>
      </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <main class="max-w-4xl mx-auto px-4 py-8">
      <slot />  â† This is where page content goes!
    </main>

    <!-- FOOTER -->
    <footer class="border-t border-gray-200 mt-12">
      <div class="max-w-4xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
        Generated by Claude Redditor
      </div>
    </footer>
  </body>
</html>
```

### Key Parts

1. **`<slot />`**: Like `{% block content %}` - replaced with page content
2. **Sticky nav**: `sticky top-0` keeps nav at top when scrolling
3. **Responsive width**: `max-w-4xl mx-auto` centers content, max 896px wide
4. **Props**: Layout accepts `title` and optional `description`

## Using the Layout

Every page uses the layout like this:

```astro
---
import Layout from '../layouts/Layout.astro';
---

<Layout title="My Page Title" description="Optional description">
  <!-- This content replaces <slot /> -->
  <h1>Page Content Here</h1>
  <p>Everything here goes into the main area</p>
</Layout>
```

## Pages and Routing

### Static Routes

Files in `src/pages/` become URLs automatically:

```
src/pages/
â”œâ”€â”€ index.astro          â†’ /
â”œâ”€â”€ about.astro          â†’ /about
â”œâ”€â”€ contact.astro        â†’ /contact
â””â”€â”€ blog/
    â”œâ”€â”€ index.astro      â†’ /blog
    â””â”€â”€ post.astro       â†’ /blog/post
```

### Dynamic Routes

**File: `src/pages/digest/[id].astro`**

The `[id]` part is a **parameter** - it matches anything!

```
/digest/claudeia_2026-01-27-01  â† id = "claudeia_2026-01-27-01"
/digest/wineworld_2026-01-20-01 â† id = "wineworld_2026-01-20-01"
```

**Python Flask equivalent:**
```python
@app.route('/digest/<id>')
def show_digest(id):
    # id is the dynamic part
    return render_template('digest.html', digest_id=id)
```

## Deep Dive: Dynamic Page Example

Let's understand `src/pages/digest/[id].astro`:

```astro
---
import Layout from '../../layouts/Layout.astro';
import StoryCard from '../../components/StoryCard.astro';
import type { Digest } from '../../types/digest';
import fs from 'node:fs';
import path from 'node:path';

// 1. GENERATE STATIC PATHS
// This tells Astro: "Build pages for these IDs"
export async function getStaticPaths() {
  const digestsDir = path.resolve('../outputs/web');

  if (!fs.existsSync(digestsDir)) {
    return [];  // No digests yet
  }

  // Find all JSON files
  const files = fs.readdirSync(digestsDir)
    .filter(f => f.endsWith('.json') && f !== 'latest.json');

  // Return array of {params: {id: ...}}
  return files.map(filename => ({
    params: { id: filename.replace('.json', '') },
  }));
}

// 2. GET THE ID FROM URL
const { id } = Astro.params;  // Extract 'id' from URL

// 3. LOAD DATA FOR THIS ID
const digestPath = path.resolve(`../outputs/web/${id}.json`);

let digest: Digest | null = null;
if (fs.existsSync(digestPath)) {
  const content = fs.readFileSync(digestPath, 'utf-8');
  digest = JSON.parse(content);
}

// 4. HELPER FUNCTIONS
const formatDate = (dateStr: string): string => {
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};
---

<!-- 5. RENDER THE PAGE -->
<Layout title={digest ? `Digest - ${formatDate(digest.generated_at)}` : 'Digest Not Found'}>
  {!digest ? (
    <!-- Error state: digest not found -->
    <div class="bg-white rounded-lg border border-gray-200 p-8 text-center">
      <p class="text-gray-500 text-lg">Digest not found</p>
      <a href="/" class="text-blue-600 hover:underline mt-4 inline-block">
        â† Back to all digests
      </a>
    </div>
  ) : (
    <!-- Success state: show digest -->
    <>
      <!-- Header -->
      <div class="mb-8">
        <a href="/" class="text-blue-600 hover:underline text-sm mb-4 inline-block">
          â† Back to all digests
        </a>

        <h1 class="text-3xl font-bold text-gray-900 mb-2">
          {formatDate(digest.generated_at)}
        </h1>

        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500">
          <span>Project: <span class="font-medium">{digest.project}</span></span>
          <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full">
            {digest.story_count} stories
          </span>
        </div>
      </div>

      <!-- Story list -->
      <div class="space-y-4">
        {digest.stories.map((story) => (
          <StoryCard story={story} showReasoning={true} />
        ))}
      </div>
    </>
  )}
</Layout>
```

### How `getStaticPaths()` Works

Astro calls this function at build time:

1. **Build time**: Astro runs `getStaticPaths()`
2. **It returns**: `[{params: {id: 'claudeia_2026-01-27-01'}}, {params: {id: 'wineworld_2026-01-20-01'}}]`
3. **Astro creates**:
   - `/digest/claudeia_2026-01-27-01/index.html`
   - `/digest/wineworld_2026-01-20-01/index.html`

**Python equivalent:**
```python
# At build time, generate pages for each digest
digests = load_all_digests()
for digest in digests:
    create_html_file(f'/digest/{digest.id}/index.html', render_digest(digest))
```

## Your Current Pages

### 1. `index.astro` - Homepage

```astro
---
// Load all digests
const digests = loadAllDigests();
---

<Layout title="Digest Viewer - All Digests">
  <h1>Content Digests</h1>

  {digests.length === 0 ? (
    <p>No digests yet</p>
  ) : (
    <div class="space-y-4">
      {digests.map((digest) => (
        <a href={`/digest/${digest.filename}`}>
          <!-- Digest preview card -->
        </a>
      ))}
    </div>
  )}
</Layout>
```

**Purpose**: List all available digests

### 2. `digest/[id].astro` - Single Digest

```astro
---
export async function getStaticPaths() {
  // Return all digest IDs
}

const { id } = Astro.params;
const digest = loadDigest(id);
---

<Layout title={`Digest - ${digest.date}`}>
  {digest.stories.map(story => (
    <StoryCard story={story} />
  ))}
</Layout>
```

**Purpose**: Display one digest with all its stories

### 3. `story/[id].astro` - Single Story Detail

Similar structure to digest page, but shows one story in detail.

### 4. `bookmarks.astro` - Bookmarks Page

```astro
---
// Load bookmarks.json
const bookmarks = loadBookmarks();
---

<Layout title="Bookmarks">
  {bookmarks.map(bookmark => (
    <BookmarkCard bookmark={bookmark} />
  ))}
</Layout>
```

## Creating a New Page

Let's create an "About" page:

**Create `src/pages/about.astro`:**

```astro
---
import Layout from '../layouts/Layout.astro';
---

<Layout title="About - Digest Viewer" description="About this digest viewer">
  <div class="prose max-w-none">
    <h1>About This Project</h1>

    <p>
      This digest viewer displays AI-curated content from Reddit and Hacker News,
      organized by the Claude Redditor tool.
    </p>

    <h2>How It Works</h2>

    <ol>
      <li>Scan Reddit/HN for content</li>
      <li>Classify with Claude AI</li>
      <li>Generate JSON digests</li>
      <li>Display in this web viewer</li>
    </ol>

    <a href="/" class="text-blue-600 hover:underline">
      â† Back to digests
    </a>
  </div>
</Layout>
```

**Add link to nav** in `Layout.astro`:

```astro
<nav class="flex items-center gap-4">
  <a href="/bookmarks">ğŸ”– Bookmarks</a>
  <a href="/about">â„¹ï¸ About</a>  <!-- NEW! -->
</nav>
```

Now visit `http://localhost:4321/about`!

## Layout Best Practices

### Multiple Layouts

You can have different layouts for different sections:

```
src/layouts/
â”œâ”€â”€ Layout.astro          â† Main layout
â”œâ”€â”€ DigestLayout.astro    â† Special layout for digests
â””â”€â”€ MinimalLayout.astro   â† No nav/footer
```

### Nested Layouts

Layouts can wrap other layouts:

```astro
<!-- DigestLayout.astro -->
---
import Layout from './Layout.astro';
---

<Layout title={Astro.props.title}>
  <div class="digest-specific-wrapper">
    <slot />
  </div>
</Layout>
```

## Key Takeaways

1. **Layouts**: Wrap pages with common structure (`<slot />`)
2. **Static Routes**: Files in `pages/` â†’ URLs
3. **Dynamic Routes**: `[param]` matches any value
4. **getStaticPaths()**: Generate pages for dynamic routes at build time
5. **Astro.params**: Access dynamic route parameters

## Next Steps

Tutorial 6 will teach you Tailwind CSS and how to style your pages.

---

**Try this:**
1. Create `src/pages/projects.astro` listing your projects
2. Add it to the nav in `Layout.astro`
3. Visit `/projects` in your browser!
